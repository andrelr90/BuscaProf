<html>
    <head>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <script src="https://unpkg.com/vue@3.0.0"></script>
        <link rel="stylesheet" href="./css/style.css">
        <link rel="stylesheet" href="./css/chat.css">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
        <meta charset="UTF-8">
    </head>

    <body>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

        <div id="nav-vue">
            <nav-vue></nav-vue>
        </div>

        <div id="app">
           <div class="container text-center">
               <div class = "panel panel-primary">
                  <h4> <div class = "panel-heading"> {{professor.name}} </div> </h4>
                  <h4> <div class = "panel-body"> {{professor.description}} </div> </h4>
               </div>
           </div>

           <div class = "row mt-3"> </div>

           <div class="container text-center">
               <div class = "panel panel-defaul">
                  <h4> <div class = "panel-heading"> Áreas de conhecimento </div> </h4>
                  <h4> <h4>  <div v-for="subject in professor.subjects"> {{subject.subjectName}} </div> </h4> </h4>
               </div>
           </div>

           <div class = "row mt-3"> </div>

           <h4 class="container text-center"> Preço Hr/aula: {{professor.price}} R$</h4>

        </div>


        <div id="chatSimulator">
            <chat></chat>
        </div>

        <div id="footer-vue">
            <footer-vue></footer-vue>
        </div>

    </body>

    <script src="vue-components/nav.js"></script>
    <script src="vue-components/footer.js"></script>
    <script src="vue-components/chat.js"></script>
        <script>
             let uri = window.location.href.split('?');
        var idProfessor = null
        if (uri.length == 2){
            let vars = uri[1].split('&');
            let getVars = {};
            let tmp = '';
            vars.forEach(function(v){
                tmp = v.split('=');
                if(tmp.length == 2)
                getVars[tmp[0]] = tmp[1];
            });
            idProfessor = getVars["idProfessor"]
            idProfessor = idProfessor.replace("#", "")
        }
            // A variável idProfessor armazena o id passado para essa tela
            Vue.createApp({
                    data() {
                        return {
                            professor: [],
                            id: null
                        }
                    },
                    methods: {
                        async getData(idProfessor){
                            console.log("2")
                            if(idProfessor != null){
                                this.id = idProfessor
                            }
                         
                           // console.log(this.idProfessor)
                            const headers = new Headers();
                                headers.append(
                                    "Content-Type",
                                    "application/json"
                                );
                            const request = new Request( "/searchID",
                            {
                                method: "POST",
                                headers,
                                body: JSON.stringify({ id: this.id}),
                                mode: "cors",
                                cache: "default"
                            }
                        );      
                        const res = await fetch(request);
                        const response = await res.json();
                        this.professor = response["user"]
                        },
                        async getLoggedUser(){
                            if(idProfessor != null){
                                this.getData(idProfessor)
                            } else {
                                const request = new Request( "/getLoggedUser",
                                {
                                    method: "POST"
                                }
                                )
                                const res = await fetch(request);
                                const response = await res.json()
                                console.log(response.id)
                                this.id = response.id;
                                this.getData(this.id)
                            }
                        }
                    },
                    beforeMount(){
                    this.getLoggedUser()
                },
                }).mount('#app');
        </script>
</html>